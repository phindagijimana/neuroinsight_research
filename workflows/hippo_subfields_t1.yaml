# Workflow 3: Hippocampal Subfields Segmentation T1
id: hippo_subfields_t1
name: "Hippocampal Subfields Segmentation T1"
version: "1.0.0"
type: workflow
domain: structural_mri

description: >
  Two-stage workflow: FreeSurfer recon-all followed by hippocampal
  subfield segmentation (T1 only). Produces subfield volumes and
  amygdala nuclei labels.

developer_contract: >
  Workflows only orchestrate plugins. No direct execution steps allowed.

inputs:
  required:
    - key: T1w
      type: nifti
      description: "T1-weighted MRI scan"
  optional:
    - key: subject_id
      type: string
      default: "subject"
    - key: fs_license
      type: path

input_format:
  format_name: "Single NIfTI"
  description: "A single T1-weighted MRI scan in NIfTI format."
  example_structure: |
    any_folder/
      sub-01_T1w.nii.gz

validation:
  preflight_checks:
    - "file_exists(T1w)"
    - "is_nifti(T1w)"

steps:
  - id: recon_all
    uses: freesurfer_recon
    with:
      T1w: "{inputs.T1w}"
      subject_id: "{inputs.subject_id}"
      fs_license: "{inputs.fs_license}"

  - id: segment_ha
    uses: segmentha_t1
    with:
      subjects_dir: "{step.recon_all.outputs.subjects_dir}"
      subject_id: "{inputs.subject_id}"
      fs_license: "{inputs.fs_license}"

outputs:
  native:
    - "{run_root}/native/freesurfer"
  bundle:
    - "{run_root}/bundle"

reproducibility:
  pin_containers: true
  write_run_manifest: true
  store_exact_commands: true
